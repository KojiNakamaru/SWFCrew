<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset="UTF-8">
    <title>Animator Test</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=yes,target-densitydpi=medium-dpi" />
    <style type="text/css">
      body{margin:0 auto;padding:0;image-rendering:optimizespeed;}
      #container{margin:0 auto;position:absolute;top:0;bottom:0;left:0;right:0}
      #container2{margin:0 auto;}
      #c{position:absolute;bottom:0;left:0;z-index:9999999}
    </style>
    <script type="text/javascript" src="../bin/swfcrew.js" charset="UTF-8"></script>
    <script type="text/javascript">

      var parser = null;
      var stage = null;

      function onAjax(e) {
        if (e) {
          e.preventDefault();
        }

        var container = document.getElementById("container");

        if (stage !== null) {
          stage.close();
        }
        if (parser !== null) {
          parser.swf.destroy();
        }
        container.width = container.width;

        var tXhr = new XMLHttpRequest();
        tXhr.addEventListener('load', function(e) {
          var tData = new Uint8Array(this.response);
          parser = new quickswf.Parser(tData);
          console.time('Parse');
          parser.parse(
            function(pSWF) {
              console.timeEnd('Parse');
              container.width = pSWF.width;
              container.height = pSWF.height;
              console.time('Convert');
              var tStage = stage = theatre.crews.swf.create(pSWF, container, {
                spriteType: "canvas"
              });
              console.timeEnd('Convert');
              tStage.open();
            },
            function(pError) {
              console.error(pError);
            }
          );
        }, false);

        tXhr.addEventListener('error', function(e) {
          console.log(e);
        }, false);

        tXhr.open('GET', document.getElementById('url').value, true);
        tXhr.responseType = 'arraybuffer';
        tXhr.send(null);
      }

      function onFile(e) {
        e.preventDefault();

        var container = document.getElementById("container");
        if (stage !== null) {
          stage.close();
          parser.swf.destroy();
        }
        container.width = container.width;

        var fr = new FileReader();
        var file = document.getElementById("file").files[0];

        fr.onload = function(e) {
          var tData = new Uint8Array(e.target.result);
          parser = new quickswf.Parser(tData);
          console.time('Parse');
          parser.parse(
            function(pSWF) {
              console.timeEnd('Parse');
              container.width = pSWF.width;
              container.height = pSWF.height;
              console.time('Convert');
              var tStage = stage = theatre.crews.swf.create(pSWF, container, {
                spriteType: "canvas"
              });
              console.timeEnd('Convert');
              tStage.open();
            },
            function(pError) {
              console.error(pError);
            }
          );
        };

        fr.readAsArrayBuffer(file);
      }

      document.addEventListener("DOMContentLoaded", function() {
        document.getElementById("goajax").addEventListener("click", onAjax, false);
        document.getElementById("gofile").addEventListener("click", onFile, false);

        if (window.location.hash.length > 1) {
          document.getElementById('url').value = window.location.hash.substring(1);
          onAjax();
        }

        window.addEventListener('hashchange', function() {
          document.getElementById('url').value = window.location.hash.substring(1);
          onAjax();
        }, false);
      }, false);
    </script>
  </head>
  <body>
    <canvas id="container"></canvas>
    <div id="options" style="position:absolute;z-index:999999999999;bottom:0;left:0">
      <input type="text" id="url" />
      <input type="submit" id="goajax" value="Go Ajax" />
      <input type="file" id="file" name="file" />
      <input type="submit" id="gofile" value="Go File" />
    </div>
  </body>
</html>
